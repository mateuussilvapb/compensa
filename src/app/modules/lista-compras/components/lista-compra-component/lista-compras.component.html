<div class="container">
  <h1>Minha Lista de Compras</h1>

  <!-- Formulário para adicionar nova seção -->
  <div class="card">
    <h2>Adicionar Nova Seção</h2>
    <form [formGroup]="sectionForm" (ngSubmit)="addSection()">
      <input type="text" formControlName="name" placeholder="Nome da Seção (ex: Grãos)" required>
      <button type="submit" [disabled]="sectionForm.invalid">Adicionar Seção</button>
    </form>
  </div>

  <div class="sections-container">
    <h2>Minhas Seções</h2>
    <div *ngIf="sections$ | async as sections; else loadingSections">
      <div *ngIf="sections.length > 0; else noSections">
        <ul>
          <li *ngFor="let section of sections"
              [class.selected]="section.id === selectedSectionId">
            <span (click)="selectSection(section)">
              {{ section.name }}
            </span>
            <button (click)="deleteSection(section.id!)">Excluir</button>
            <!-- Exemplo de como usar update:
            <input type="text" [value]="section.name" (blur)="updateSectionName(section, $event.target.value)">
            -->
          </li>
        </ul>
      </div>
      <ng-template #noSections>
        <p>Nenhuma seção encontrada. Adicione uma nova!</p>
      </ng-template>
    </div>
    <ng-template #loadingSections>
      <p>Carregando seções...</p>
    </ng-template>
  </div>


  <!-- Seção para gerenciar itens da seção selecionada -->
  <div *ngIf="selectedSectionId" class="card">
    <h2>Itens da Seção: {{ selectedSectionName }}</h2>

    <!-- Formulário para adicionar novo item -->
    <h3>Adicionar Novo Item</h3>
    <form [formGroup]="itemForm" (ngSubmit)="addItemToSelectedSection()">
      <input type="text" formControlName="name" placeholder="Nome do Item (ex: Arroz)" required>
      <input type="number" formControlName="weight" placeholder="Peso (ex: 1.2)">
      <select formControlName="type">
        <option value="kg">kg</option>
        <option value="L">L</option>
        <option value="ml">ml</option>
        <option value="g">g</option>
        <option value="unidade">unidade</option>
        <option value="pacote">pacote</option>
      </select>
      <input type="number" formControlName="price" placeholder="Preço (ex: 8.50)">
      <button type="submit" [disabled]="itemForm.invalid">Adicionar Item</button>
    </form>

    <!-- Lista de itens da seção selecionada -->
    <h3>Lista de Itens</h3>
    <div *ngIf="items$ | async as items; else loadingItems">
      <div *ngIf="items.length > 0; else noItems">
        <ul>
          <li *ngFor="let item of items">
            {{ item.name }}
            <span *ngIf="item.weight">{{ item.weight }} {{ item.type }}</span>
            <span *ngIf="item.price"> - R$ {{ item.price | number:'1.2-2' }}</span>
            <button (click)="deleteItem(selectedSectionId, item.id!)">Excluir</button>
            <!-- Adicionar edição inline seria mais complexo, mas possível com mais inputs -->
          </li>
        </ul>
      </div>
      <ng-template #noItems>
        <p>Nenhum item nesta seção.</p>
      </ng-template>
    </div>
    <ng-template #loadingItems>
      <p>Carregando itens...</p>
    </ng-template>
  </div>
</div>
